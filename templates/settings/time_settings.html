{% extends "base.html" %}

{% block stylesSection %}
<link rel="stylesheet" href="/static/css/teacher_settings.css">
<link rel="stylesheet" href="/static/js/node_modules/datetimepicker/dist/DateTimePicker.css">
<style>
.dtpicker-content {
    max-width: 550px;
}
.dtpicker-header .dtpicker-title {
    font-size: 2.2em;
}
.dtpicker-header .dtpicker-value {
    font-size: 2em;
}
.dtpicker-components {
    font-size: 2em;
}
.dtpicker-buttonCont .dtpicker-button {
    font-size: 2em;
    background: rgb(0, 123, 255);
    color: rgb(255, 255, 255) !important;
    border-radius: .3rem;
    border-color: rgb(0, 123, 255);
}
</style>
{% endblock %}

{% block scriptsSection %}
<script src="/static/js/node_modules/jquery/dist/jquery.min.js"></script>
<script src="/static/js/node_modules/datetimepicker/dist/DateTimePicker.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        let currentDate = new Date();
        let month = appendLeadZero(currentDate.getMonth() + 1);
        let year = currentDate.getFullYear();
        let day = appendLeadZero(currentDate.getDate());
        let hours = appendLeadZero(currentDate.getHours());
        let minutes = appendLeadZero(currentDate.getMinutes());

        document.getElementsByName("set-time")[0].value = hours + ":" + minutes;
        document.getElementsByName("set-date")[0].value = day + "-" + month + "-" + year;
    });

    function setTime() {
        var newTime = document.getElementsByName("set-time")[0].value;
        var newDate = document.getElementsByName("set-date")[0].value;

        if (newTime === "" || newDate === "") {
            return alert("Incorrect value");
        }

        $.ajax({
            url: "/apply_time",
            type: "POST",
            data: JSON.stringify({"set-time": newTime, "set-date": newDate,}),
            contentType: "application/json; charset=utf8",
            dataType: "json",
            success: function () {
                $("#time-saved").fadeIn();
                setTimeout(function () {
                    $("#time-saved").fadeOut(1000);
                }, 3000);
            }
        });
    }

    $("#dtBox").DateTimePicker({
        dateFormat: "dd-MM-yyyy",
        shortDayNames: ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"],
        fullDayNames: ["Воскресенье", "Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота"],
        shortMonthNames: ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"],
        fullMonthNames: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Отктябрь", "Ноябрь", "Декабрь"],
        titleContentDate: "Установка даты",
        titleContentTime: "Установка времени",
        setButtonContent: "Установить",
        clearButtonContent: "Очистить",
        incrementButtonContent: "▲",
        decrementButtonContent: "▼",
        buttonsToDisplay: ["HeaderCloseButton", "SetButton", "ClearButton"],
        animationDuration: 200,
    });

    function appendLeadZero(n){
    if(n <= 9){
        return "0" + n;
    }
    return n
    }
</script>
{% endblock %}

{% block content %}
<div class="container">
	<div class="row">
		<div class="col">
			<form id="time-form" onsubmit="setTime(); return false;">
                <div class="form-group">
                    <label for="time" class="col-form-label col-form-label-lg">Время</label>
                    <input class="form-control form-control-lg" type="time" name="set-time" id="time" data-format="hh:mm">
                </div>

                <div class="form-group">
                    <label for="date" class="col-form-label col-form-label-lg">Дата</label>
                    <input class="form-control form-control-lg" type="date" name="set-date" id="date" data-format="dd-MMM-yyyy">
                </div>
                <button type="submit" class="btn btn-lg btn-primary btn-block p-3 mt-4">
                    <p class="h2">OK</p>
                </button>
            </form>
            <div class="saved-banner" id="time-saved">
            Время установлено
            </div>
            <div id="dtBox"></div>
		</div>
	</div>
</div>
{% endblock %}

