<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Управление</title>
    <link rel="stylesheet" href="../../static/css/style.css">
    <link rel="stylesheet" href="../../static/css/settings_style.css">
    <script src="../static/js/node_modules/jquery/dist/jquery.min.js"></script>

  </head>
  <body>
    <h1 align=center class="banner"> Управление </h1>
    <div id="settings-block">
    	<table id=setting-table>
    		<tr>
    			<td>
    				<h3>Лампа</h3>
    			</td>
    			<td>
    				<div class="switch">
    					<input type="checkbox" id="lamp-switch" class="switch-check">
    						<label for="lamp-switch" class="switch-label">
    							<span class="switch-slider switch-slider-on"></span>
        						<span class="switch-slider switch-slider-off"></span>
    						</label>
					</div>          
    			</td>
    			<td> 
    				<input type="radio" class="lamp-value" name="lamp-radio">
    				<label for="lamp-value1">18/6</label>
    				<input type="radio" class="lamp-value" name="lamp-radio">
    				<label for="lamp-value2">12/12</label>
    			</td>
    		</tr>
    		<tr>
    			<td>
    				<h3>Вентилятор</h3>
    			</td>
    			<td>
    				<div class="switch">
    					<input type="checkbox" id="fan-switch" class="switch-check">
    						<label for="fan-switch" class="switch-label">
    							<span class="switch-slider switch-slider-on"></span>
        						<span class="switch-slider switch-slider-off"></span>
    						</label>
					</div>
    			</td>
    			<td>
    				<input type="radio" class="fan-value" name="fan-radio">
    				<label for="fan-value1" class="fan-label">1 m</label>
    				<input type="radio" class="fan-value" name="fan-radio"> 
    				<label for="fan-value2" class="fan-label">2 m</label>
    				<input type="radio" class="fan-value" name="fan-radio"> 
    				<label for="fan-value3" class="fan-label">5 m</label>
    				<input type="radio" class="fan-value" name="fan-radio"> 
    				<label for="fan-value4" class="fan-label">10 m</label>
    			</td>
    		</tr>
    		<tr>
    			<td>
    				<h3>Компрессор</h3>
    			</td>
    			<td>
    				<div class="switch">
    					<input type="checkbox" id="compressor-switch" class="switch-check">
    						<label for="compressor-switch" class="switch-label">
    							<span class="switch-slider switch-slider-on"></span>
        						<span class="switch-slider switch-slider-off"></span>
    						</label>
					</div>
    			</td>
    			<td>
    			</td>
    		</tr>
    	</table>
    </div>
    <input type="button" value="Настроить" onclick="setChanges()">
    <script>
	function setChanges() {
		var lamp = document.querySelector("#lamp-switch");
		var fan = document.querySelector("#fan-switch");
		var compressor = document.querySelector("#compressor-switch");
		var lampValue = document.getElementsByClassName("lamp-value");
		var fanValue = document.getElementsByClassName("fan-value");

		var request = {
			lamp : [0, 0],
			fan : [0, 0],
			compressor : 0
		};	
		if (lamp.checked) {
			request.lamp[0] = 1;
		}
		if (fan.checked) {
			request.fan[0] = 1;
		}
		if (compressor.checked) {
			request.compressor[0] = 1;
		}
		
		if (lampValue[0].checked) {
			request.lamp[1] = 18;
		} else if (lampValue[1].checked) {
			request.lamp[1] = 12;
		}
		for (var i = 0; i < fanValue.length; i++) {
			if (fanValue[i].checked) {
				  request.fan[1] = parseInt((document.getElementsByClassName("fan-label")[i].textContent.split(' '))[0]);
				  break;
			}
		}
	
		console.log(request); // testing
		
		$.ajax({
			url: "/accept_settings",
			type: "POST",
			data: JSON.stringify(request),
			contentType: "application/json; charset=utf8",
			dataType:"json",
			success: function() {
					alert("Настройки приняты");
				 }
		});
	}
	
	window.onload = function() {
		var currentState= {{jsonStr}};
		console.log(currentState);
		document.getElementById("lamp-switch").checked = !!currentState.lamp[0];
		document.getElementById("fan-switch").checked = !!currentState.fan[0]; 
		document.getElementById("compressor-switch").checked = !!currentState.compressor[0];
		if (currentState.lamp[1] === 18) {
			document.getElementsByClassName("lamp-value")[0].checked = true;
		} else if (currentState.lamp[1] === 12) {
			document.getElementsByClassName("lamp-value")[1].checked = true;
		}
		switch(currentState.fan[1]) {
			case 1:
				document.getElementsByClassName("fan-value")[0].checked = true;
				break;
			case 2: 
				document.getElementsByClassName("fan-value")[1].checked = true;
				break;
			case 5:
				document.getElementsByClassName("fan-value")[2].checked = true;
				break;
			case 10:
				document.getElementsByClassName("fan-value")[3].checked = true;
				break;
			default:
				break;	
		}
	}
    </script>
  </body>
</html>
